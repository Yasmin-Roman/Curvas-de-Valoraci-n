<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Simulador de Titulación</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3655/3655611.png">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3655/3655611.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary: #4f46e5; }
        body { touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
        .slider-custom { -webkit-appearance: none; width: 100%; height: 10px; border-radius: 10px; background: #e2e8f0; outline: none; }
        .slider-custom::-webkit-slider-thumb { -webkit-appearance: none; width: 30px; height: 30px; border-radius: 50%; background: var(--primary); border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.2); cursor: pointer; }
        @keyframes drop-fall {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(40px) scale(0.5); opacity: 0; }
        }
        .gota { width: 8px; height: 12px; background-color: #60a5fa; border-radius: 50% 50% 50% 50% / 80% 80% 20% 20%; position: absolute; left: 50%; top: 20px; margin-left: -4px; animation: drop-fall 0.4s linear infinite; display: none; }
        .btn-drop { background: white; border: 2px solid #e2e8f0; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.5rem; color: #4f46e5; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .btn-drop:active { transform: scale(0.9); background: #f1f5f9; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen p-2 flex flex-col items-center font-sans text-slate-900">
    <div class="w-full max-w-md bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border border-slate-200">
        
        <div class="bg-indigo-950 p-4 text-white text-center">
            <h1 class="text-base font-bold uppercase tracking-tight">Simulador de Titulación</h1>
            <p class="text-indigo-300 text-[10px] font-bold uppercase tracking-widest italic">Análisis de Indicadores y Curvas</p>
        </div>

        <div class="p-4 space-y-4">
            <div class="bg-white rounded-xl border border-slate-100 p-1 h-[220px]">
                <canvas id="titrationChart"></canvas>
            </div>

            <div id="indicatorBox" class="rounded-3xl p-4 text-center border-2 transition-all duration-300 bg-white border-slate-200 relative">
                <div class="absolute -top-6 left-1/2 -translate-x-1/2 w-12 h-12 flex flex-col items-center">
                    <div class="w-2 h-8 bg-slate-200 border-x border-slate-300 rounded-t-sm relative">
                        <div id="gotaAnim" class="gota"></div>
                    </div>
                </div>

                <div class="flex justify-between items-center px-2 mt-4">
                    <div class="text-left">
                        <p class="text-[7px] font-black text-slate-400 uppercase">Vol. Vaso</p>
                        <p class="text-[10px] font-bold text-slate-700"><span id="vTotalDisplay">50.00</span> mL</p>
                    </div>
                    <div id="indicatorName" class="text-[8px] font-bold text-slate-500 bg-slate-100 px-3 py-1 rounded-full uppercase">Potenciómetro</div>
                    <div class="text-right">
                        <p class="text-[7px] font-black text-slate-400 uppercase">Gotas</p>
                        <p class="text-[10px] font-bold text-slate-700" id="dropCount">0</p>
                    </div>
                </div>
                
                <div id="phDisplay" class="text-6xl font-mono font-black text-slate-900 leading-none my-2">2.87</div>
            </div>

            <div class="bg-slate-50 p-4 rounded-2xl border border-slate-200">
                <div class="flex items-center justify-between mb-4">
                    <button id="btnMinus" class="btn-drop">−</button>
                    <div class="text-center">
                        <span class="text-[9px] font-black text-slate-400">Valorante añadido (0.1M)</span>
                        <div id="volValue" class="text-3xl font-mono font-black text-indigo-600">0.00 mL</div>
                    </div>
                    <button id="btnPlus" class="btn-drop">+</button>
                </div>
                <input type="range" id="volSlider" min="0" max="100" step="0.05" value="0" class="slider-custom">
            </div>

            <div class="grid grid-cols-2 gap-2">
                <select id="titrationType" class="w-full bg-slate-50 p-3 rounded-xl border font-bold text-[10px] border-slate-200 outline-none">
                    <option value="ff">HCl (AF) + NaOH (BF)</option>
                    <option value="df" selected>CH₃COOH (AD) + NaOH (BF)</option>
                    <option value="fd">NH₄OH (BD) + HCl (HF)</option>
                </select>
                <select id="indicatorSelect" class="w-full bg-slate-50 p-3 rounded-xl border font-bold text-[10px] border-slate-200 outline-none">
                    <option value="ninguno">Sin Indicador</option>
                    <option value="fenol">Fenolftaleína (8.2 - 10)</option>
                    <option value="azul">Azul de Bromotimol (6 - 7.6)</option>
                    <option value="metilo">Anaranjado de Metilo (3.1 - 4.4)</option>
                </select>
            </div>

            <button id="resetBtn" class="w-full bg-red-500 text-white text-[10px] font-bold py-3 rounded-xl shadow-md active:scale-95 transition-all">REINICIAR EXPERIMENTO</button>

            <div class="text-center pt-2 border-t border-slate-100">
                <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">Química Analítica-2026</p>
            </div>
        </div>
    </div>

    <script>
        let chart; let recordedData = []; let lastV = 0;
        const V0 = 50.0, C = 0.1, Kw = 1e-14;
        const indicatorRanges = {
            fenol: { min: 8.2, max: 10.0, color: 'rgba(236, 72, 153, 0.15)' },
            azul: { min: 6.0, max: 7.6, color: 'rgba(59, 130, 246, 0.15)' },
            metilo: { min: 3.1, max: 4.4, color: 'rgba(249, 115, 22, 0.15)' },
            ninguno: null
        };

        function calculatePH(vAdd, type) {
            vAdd = Math.round(vAdd * 100) / 100;
            const vtL = (V0 + vAdd) / 1000, nAdd = (vAdd / 1000) * C, nIni = (V0 / 1000) * C;
            
            if (type === 'ff') {
                if (vAdd < 49.98) return -Math.log10((nIni - nAdd) / vtL);
                if (vAdd > 50.02) return 14 + Math.log10((nAdd - nIni) / vtL);
                return 7.00;
            }
            if (type === 'df') {
                const pKa = 4.7447, Ka = 1.8e-5;
                if (vAdd <= 0) return -Math.log10(Math.sqrt(Ka * C));
                if (vAdd < 49.98) return pKa + Math.log10(nAdd / (nIni - nAdd));
                if (Math.abs(vAdd - 50) < 0.03) return 14 - (-Math.log10(Math.sqrt((Kw/Ka)*(nIni/vtL))));
                return 14 + Math.log10((nAdd - nIni) / vtL);
            }
            if (type === 'fd') {
                const pKb = 4.7447, pKaN = 9.2553, Kb = 1.8e-5;
                if (vAdd <= 0) return 14 - (-Math.log10(Math.sqrt(Kb * C)));
                if (vAdd < 49.98) return pKaN + Math.log10((nIni - nAdd) / nAdd);
                if (Math.abs(vAdd - 50) < 0.03) return -Math.log10(Math.sqrt((Kw/Kb)*(nIni/vtL)));
                return -Math.log10((nAdd - nIni) / vtL);
            }
            return 7;
        }

        const boxAnnotation = {
            id: 'boxAnnotation',
            beforeDraw(chart) {
                const ind = document.getElementById('indicatorSelect').value;
                const range = indicatorRanges[ind];
                if (range) {
                    const {ctx, chartArea, scales: {y}} = chart;
                    ctx.save();
                    ctx.fillStyle = range.color;
                    const yMin = y.getPixelForValue(range.max);
                    const yMax = y.getPixelForValue(range.min);
                    ctx.fillRect(chartArea.left, yMin, chartArea.width, yMax - yMin);
                    ctx.restore();
                }
            }
        };

        function initChart() {
            const ctx = document.getElementById('titrationChart').getContext('2d');
            if(chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: { datasets: [{ data: recordedData, borderColor: '#4f46e5', borderWidth: 2, pointRadius: 0, tension: 0.1 }] },
                plugins: [boxAnnotation],
                options: { 
                    responsive: true, maintainAspectRatio: false, animation: false,
                    scales: { 
                        y: { min: 0, max: 14, title: {display: true, text: 'pH', font: {size: 9}}, ticks: {font: {size: 8}} }, 
                        x: { type: 'linear', min: 0, max: 100, title: {display: true, text: 'mL Titulante', font: {size: 9}}, ticks: {font: {size: 8}} } 
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function updateUI() {
            const v = parseFloat(document.getElementById('volSlider').value);
            const type = document.getElementById('titrationType').value;
            const ph = calculatePH(v, type);
            
            if (v !== lastV) {
                const gotaAnim = document.getElementById('gotaAnim');
                gotaAnim.style.display = 'block';
                setTimeout(() => gotaAnim.style.display = 'none', 300);
            }
            lastV = v;

            document.getElementById('volValue').innerText = v.toFixed(2) + " mL";
            document.getElementById('phDisplay').innerText = ph.toFixed(2);
            document.getElementById('vTotalDisplay').innerText = (V0 + v).toFixed(2);
            document.getElementById('dropCount').innerText = Math.round(v * 20);

            if (!recordedData.some(p => Math.abs(p.x - v) < 0.01)) {
                recordedData.push({x: v, y: ph});
                recordedData.sort((a, b) => a.x - b.x);
            }
            chart.update('none');

            const ind = document.getElementById('indicatorSelect').value, box = document.getElementById('indicatorBox'), nameEl = document.getElementById('indicatorName');
            let color = "white", name = "Potenciómetro";
            if (ind === 'fenol') { name = "Fenolftaleína"; color = ph > 8.2 ? `rgba(236, 72, 153, ${Math.min((ph-8.2)/1.8, 0.8)})` : "white"; }
            else if (ind === 'azul') { name = "Azul de Bromotimol"; if (ph < 6.0) color = "#fef08a"; else if (ph > 7.6) color = "#93c5fd"; else color = "#86efac"; }
            else if (ind === 'metilo') { name = "Anaranjado de Metilo"; if (ph < 3.1) color = "#fca5a5"; else if (ph > 4.4) color = "#fdba74"; else color = "#fde047"; }
            box.style.backgroundColor = color; nameEl.innerText = name;
        }

        document.getElementById('btnPlus').addEventListener('click', () => { const s = document.getElementById('volSlider'); s.value = parseFloat(s.value) + 0.05; updateUI(); });
        document.getElementById('btnMinus').addEventListener('click', () => { const s = document.getElementById('volSlider'); s.value = parseFloat(s.value) - 0.05; updateUI(); });
        document.getElementById('volSlider').addEventListener('input', updateUI);
        document.getElementById('titrationType').addEventListener('change', resetAll);
        document.getElementById('indicatorSelect').addEventListener('change', () => { initChart(); updateUI(); });
        document.getElementById('resetBtn').addEventListener('click', resetAll);
        function resetAll() { recordedData = [{x: 0, y: calculatePH(0, document.getElementById('titrationType').value)}]; document.getElementById('volSlider').value = 0; initChart(); updateUI(); }
        window.onload = resetAll;
    </script>
</body>

</html>




